<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My ToDo„É™„Çπ„Éà</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-color: #f6f6f6;
      margin: 0;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 700px;
      max-width: 100%;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    .input-area {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    input, button {
      font-size: 16px;
    }

    input[type="text"] {
      flex: 1;
      min-width: 200px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    input[type="datetime-local"] {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      background-color: #3498db;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #2980b9;
    }

    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    ul {
      list-style: none;
      padding: 0;
      margin-top: 20px;
    }

    li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      background-color: #fff;
      max-width: 100%;
      box-sizing: border-box;
    }

    li input[type="checkbox"] {
      flex-shrink: 0;
      transform: scale(1.2);
    }

    li .task-content {
      flex: 1;
      min-width: 0;
      overflow-x: auto;
      white-space: nowrap;
      scrollbar-width: none;
    }

    li .task-content::-webkit-scrollbar {
      display: none;
    }

    li.completed .task-title {
      text-decoration: line-through;
      color: gray;
    }

    li button {
      flex-shrink: 0;
      padding: 6px 10px;
      background-color: #e74c3c;
      border-radius: 6px;
    }

    li button:hover {
      background-color: #c0392b;
    }

    /* üü° Á∑†ÂàáÁä∂ÊÖãÂà•„Ç´„É©„Éº */
    .deadline-normal { color: black; }
    .deadline-soon { color: #e67e22; }
    .deadline-warning { color: #f1c40f; }
    .deadline-overdue { color: #e74c3c; }

    /* üì± „Çπ„Éû„ÉõÂØæÂøú */
    @media (max-width: 600px) {
      .container {
        width: 100%;
        padding: 16px;
      }

      h1 {
        font-size: 1.4rem;
      }

      .input-area {
        flex-direction: column;
        align-items: stretch;
      }

      input[type="text"],
      input[type="datetime-local"],
      button {
        width: 100%;
        font-size: 1rem;
      }

      li {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }

      li .task-content {
        white-space: normal;
        word-wrap: break-word;
        overflow-x: hidden;
      }

      li button {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>My ToDo„É™„Çπ„Éà</h1>
    <div class="input-area">
      <input type="text" id="taskInput" placeholder="„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ..." />
      <input type="datetime-local" id="deadlineInput" />
      <button id="addBtn">ËøΩÂä†</button>
    </div>
    <div class="buttons">
      <button id="sortCompletedBtn">ÂÆå‰∫ÜÊ∏à„Åø„Çí‰∏ã„Å´‰∏¶„Åπ„Çã</button>
      <button id="toggleCompletedBtn">ÂÆå‰∫ÜÊ∏à„Åø„ÇíÈùûË°®Á§∫„Å´„Åô„Çã</button>
    </div>
    <ul id="taskList"></ul>
  </div>

  <script>
    const taskInput = document.getElementById("taskInput");
    const deadlineInput = document.getElementById("deadlineInput");
    const addBtn = document.getElementById("addBtn");
    const taskList = document.getElementById("taskList");
    const sortCompletedBtn = document.getElementById("sortCompletedBtn");
    const toggleCompletedBtn = document.getElementById("toggleCompletedBtn");

    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    let sortCompletedLast = false;
    let hideCompleted = false;

    function saveTasks() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
    }

    function compareTasks(a, b) {
      if (sortCompletedLast) {
        if (a.completed !== b.completed) {
          return a.completed ? 1 : -1;
        }
      }
      const da = new Date(a.deadline);
      const db = new Date(b.deadline);
      return da - db;
    }

    function getDeadlineClass(diffMs) {
      if (isNaN(diffMs)) return "deadline-normal";
      if (diffMs < 0) return "deadline-overdue";
      if (diffMs < 24 * 60 * 60 * 1000) return "deadline-soon";
      if (diffMs < 3 * 24 * 60 * 60 * 1000) return "deadline-warning";
      return "deadline-normal";
    }

    function renderTasks() {
      taskList.innerHTML = "";
      tasks.sort(compareTasks);

      tasks.forEach((task, index) => {
        if (hideCompleted && task.completed) return;

        const li = document.createElement("li");
        if (task.completed) li.classList.add("completed");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = task.completed;
        checkbox.addEventListener("change", () => {
          task.completed = !task.completed;
          saveTasks();
          renderTasks();
        });

        const taskContent = document.createElement("div");
        taskContent.className = "task-content";

        const title = document.createElement("span");
        title.textContent = task.title;
        title.className = "task-title";

        const small = document.createElement("small");
        const deadline = new Date(task.deadline);
        const now = new Date();
        const diffMs = deadline - now;

        let remainingText = "";
        if (!isNaN(diffMs) && diffMs > 0) {
          const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
          const hours = Math.floor((diffMs / (1000 * 60 * 60)) % 24);
          const mins = Math.floor((diffMs / (1000 * 60)) % 60);
          if (days > 0) remainingText = `Ôºà„ÅÇ„Å®${days}Êó•${hours}ÊôÇÈñìÔºâ`;
          else if (hours > 0) remainingText = `Ôºà„ÅÇ„Å®${hours}ÊôÇÈñì${mins}ÂàÜÔºâ`;
          else remainingText = `Ôºà„ÅÇ„Å®${mins}ÂàÜÔºâ`;
        } else {
          remainingText = "ÔºàÊúüÈôêÂàá„ÇåÔºâ";
        }

        const deadlineClass = getDeadlineClass(diffMs);
        small.classList.add(deadlineClass);
        small.textContent = `Á∑†Âàá: ${isNaN(deadline.getTime()) ? "Êú™Ë®≠ÂÆö" : deadline.toLocaleString()} ${remainingText}`;

        taskContent.appendChild(title);
        taskContent.appendChild(document.createElement("br"));
        taskContent.appendChild(small);

        const delBtn = document.createElement("button");
        delBtn.textContent = "ÂâäÈô§";
        delBtn.addEventListener("click", () => {
          tasks.splice(index, 1);
          saveTasks();
          renderTasks();
        });

        li.appendChild(checkbox);
        li.appendChild(taskContent);
        li.appendChild(delBtn);
        taskList.appendChild(li);
      });

      sortCompletedBtn.textContent = sortCompletedLast ? "ÂÆå‰∫ÜÊ∏à„Åø„Çí‰∏ä„Å´Êàª„Åô" : "ÂÆå‰∫ÜÊ∏à„Åø„Çí‰∏ã„Å´‰∏¶„Åπ„Çã";
      toggleCompletedBtn.textContent = hideCompleted ? "ÂÆå‰∫ÜÊ∏à„Åø„ÇíË°®Á§∫„Åô„Çã" : "ÂÆå‰∫ÜÊ∏à„Åø„ÇíÈùûË°®Á§∫„Å´„Åô„Çã";
    }

    addBtn.addEventListener("click", () => {
      const title = taskInput.value.trim();
      const deadline = deadlineInput.value;
      if (!title || !deadline) return alert("„Çø„Çπ„ÇØÂêç„Å®Á∑†ÂàáÊó•ÊôÇ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
      tasks.push({ title, deadline, completed: false });
      saveTasks();
      taskInput.value = "";
      deadlineInput.value = "";
      renderTasks();
    });

    sortCompletedBtn.addEventListener("click", () => {
      sortCompletedLast = !sortCompletedLast;
      renderTasks();
    });

    toggleCompletedBtn.addEventListener("click", () => {
      hideCompleted = !hideCompleted;
      renderTasks();
    });

    setInterval(renderTasks, 60000);
    renderTasks();
  </script>
</body>
</html>
